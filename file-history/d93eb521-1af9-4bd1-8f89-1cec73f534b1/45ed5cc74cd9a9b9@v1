# Payment Service (Darwin) - Study Progress Tracker

> **Started:** _______________
> **Target Completion:** 4 weeks from start
> **Current Status:** Not Started

---

## Quick Links

| Document | Purpose |
|----------|---------|
| [README.md](./README.md) | Start here - Overview & navigation |
| [01-overview.md](./01-overview.md) | Tech stack, project structure |
| [02-data-layer.md](./02-data-layer.md) | Database, entities, caching |
| [03-provider-integration.md](./03-provider-integration.md) | Provider adapters, webhooks |
| [04-payment-flow.md](./04-payment-flow.md) | Workflows, state machines |
| [05-key-files-reference.md](./05-key-files-reference.md) | File lookup reference |
| [06-study-path.md](./06-study-path.md) | Weekly breakdown |

---

## Overall Progress

```
Week 1: Foundation          [░░░░░░░░░░] 0%
Week 2: Data Layer          [░░░░░░░░░░] 0%
Week 3: Provider Integration [░░░░░░░░░░] 0%
Week 4: Payment Flow        [░░░░░░░░░░] 0%
Expert Challenges           [░░░░░░░░░░] 0%
─────────────────────────────────────────
TOTAL                       [░░░░░░░░░░] 0%
```

---

# WEEK 1: FOUNDATION

**Goal:** Understand the big picture - tech stack, structure, and core concepts

## Day 1-2: Setup & Overview

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Read the main README and understand navigation | [README.md](./README.md) |
| ☐ | Read the complete overview document | [01-overview.md](./01-overview.md) |
| ☐ | Clone and build the project (`./gradlew build`) | - |
| ☐ | Explore `DarwinApplication.java` entry point | [01-overview.md#entry-point](./01-overview.md) |
| ☐ | Scan `application.properties` (first 200 lines) | [01-overview.md#configuration](./01-overview.md) |

### Key Learnings Checklist
- [ ] Know the server runs on port 9010 with context path `/payments`
- [ ] Understand Java 17 + Spring Boot 2.7.14 stack
- [ ] Know the main databases: MySQL (Master-Replica), DynamoDB, Redis

## Day 3-4: Project Structure

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Map the directory structure mentally | [01-overview.md#project-structure](./01-overview.md) |
| ☐ | Identify V2 package as primary implementation | [01-overview.md#project-structure](./01-overview.md) |
| ☐ | Understand controller → service → workflow pattern | [01-overview.md#project-structure](./01-overview.md) |
| ☐ | Review key directories: `controller/v2/`, `v2/workflow/`, `entity/v2/` | [05-key-files-reference.md](./05-key-files-reference.md) |

### Key Directories to Know
```
src/main/java/in/dreamplug/darwin/
├── controller/v2/      # REST endpoints
├── v2/workflow/create/ # Core business logic
├── entity/v2/          # JPA entities
├── statemachine/       # State machines
├── planner/            # Provider routing
└── cache/              # Caching layer
```

## Day 5: Core Concepts

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Understand Order → Payment → PaymentAttempt hierarchy | [01-overview.md#core-concepts](./01-overview.md) |
| ☐ | Learn the 7-step workflow pattern | [01-overview.md#core-concepts](./01-overview.md), [04-payment-flow.md#the-7-step-workflow-pipeline](./04-payment-flow.md) |
| ☐ | Study entity lifecycle states (CREATED → PROCESSING → COMPLETED) | [01-overview.md#core-concepts](./01-overview.md) |
| ☐ | Review internal service dependencies | [01-overview.md#internal-service-dependencies](./01-overview.md) |
| ☐ | Understand authentication filters | [01-overview.md#authentication--security](./01-overview.md) |

### Payment Hierarchy (Critical)
```
Order (1)
    └── Payment (M)
            └── PaymentAttempt (M)
                    └── RefundAttempt (M via Refund)
```

---

## ✅ WEEK 1 CHECKPOINT

| Status | Checkpoint Item |
|--------|-----------------|
| ☐ | Can explain the tech stack to someone |
| ☐ | Know the project directory structure |
| ☐ | Understand Order → Payment → PaymentAttempt relationship |
| ☐ | Know what the 7-step workflow pattern is |
| ☐ | Can find key files in the codebase |

**Week 1 Completion Date:** _______________

---

# WEEK 2: DATA LAYER

**Goal:** Master the database architecture, entities, and caching patterns

## Day 1-2: Entities

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Read the complete data layer document | [02-data-layer.md](./02-data-layer.md) |
| ☐ | Study `BaseEntity.java` (id, timestamps, audit) | [02-data-layer.md#base-classes](./02-data-layer.md) |
| ☐ | Study `BaseExternalEntity.java` (external_id, version) | [02-data-layer.md#baseexternalentity](./02-data-layer.md) |
| ☐ | Review `OrderEntity.java` structure | [02-data-layer.md#orderentity](./02-data-layer.md), [05-key-files-reference.md#core-entities](./05-key-files-reference.md) |
| ☐ | Study `PaymentV2Entity.java` and relationships | [02-data-layer.md#core-entities](./02-data-layer.md) |
| ☐ | Understand `PaymentAttemptV2Entity.java` (most complex) | [02-data-layer.md#paymentattemptv2entity](./02-data-layer.md) |

### Entity Inheritance
```
BaseEntity (id, created_at, updated_at, created_by, updated_by)
    └── BaseExternalEntity (+ external_id UUID, @Version)
            ├── OrderEntity
            ├── PaymentV2Entity
            ├── PaymentAttemptV2Entity
            ├── RefundEntity
            └── ClientEntity
```

## Day 3: Database Architecture

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Understand Master-Replica routing concept | [02-data-layer.md#master-replica-architecture](./02-data-layer.md) |
| ☐ | Study `MasterDataSourceConfiguration.java` | [02-data-layer.md#configuration-files](./02-data-layer.md), [05-key-files-reference.md#database-configuration](./05-key-files-reference.md) |
| ☐ | Study `ReplicaDataSourceConfiguration.java` | [02-data-layer.md#configuration-files](./02-data-layer.md) |
| ☐ | Learn `@ReplicaRepository` annotation usage | [02-data-layer.md#usage-pattern](./02-data-layer.md) |
| ☐ | Understand HikariCP connection pools | [02-data-layer.md#hikaricp-pool-configuration](./02-data-layer.md) |

### Master-Replica Pattern
```java
// Writes go to Master (default)
@Repository
public interface PaymentRepository extends JpaRepository<...> {}

// Reads can use Replica
@Repository
@ReplicaRepository  // Routes to replica
public class RefundEntityReplicaDAOImpl extends AbstractReplicaDAOImpl<...> {}
```

## Day 4: Repositories & Queries

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Review `OrderRepository.java` with FETCH JOIN patterns | [02-data-layer.md#jpa-repository-pattern](./02-data-layer.md) |
| ☐ | Study `PaymentAttemptRepository.java` | [05-key-files-reference.md#jpa-repositories](./05-key-files-reference.md) |
| ☐ | Understand DAO pattern with custom EntityManager | [02-data-layer.md#dao-pattern-custom-entitymanager](./02-data-layer.md) |
| ☐ | Learn about JSON columns and converters | [02-data-layer.md#json-columns--converters](./02-data-layer.md) |
| ☐ | Understand optimistic locking with @Version | [02-data-layer.md#optimistic-locking--audit](./02-data-layer.md) |

## Day 5: Caching & DynamoDB

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Study `ClientConfigurationCache.java` as pattern example | [02-data-layer.md#cache-implementation-pattern](./02-data-layer.md), [05-key-files-reference.md#caches](./05-key-files-reference.md) |
| ☐ | Understand jittered TTL pattern (thundering herd prevention) | [02-data-layer.md#jittered-ttls-thundering-herd-prevention](./02-data-layer.md) |
| ☐ | Review all Caffeine caches and their TTLs | [02-data-layer.md#caffeine-caches](./02-data-layer.md) |
| ☐ | Understand MySQL vs DynamoDB usage | [02-data-layer.md#what-goes-where](./02-data-layer.md) |
| ☐ | Study DynamoDB tables and entities | [02-data-layer.md#dynamodb-tables](./02-data-layer.md) |
| ☐ | Review `AbstractDynamoDBDAO.java` pattern | [02-data-layer.md#dynamodb-dao-pattern](./02-data-layer.md) |

### Cache TTLs Quick Reference
| Cache | TTL |
|-------|-----|
| ClientConfigurationCache | 10-20 min |
| PaymentProviderCache | 15-25 min |
| DecisionTreeObjectCache | 180-190 min |
| FeeCache | 1 day |

---

## ✅ WEEK 2 CHECKPOINT

| Status | Checkpoint Item |
|--------|-----------------|
| ☐ | Can explain entity inheritance (BaseEntity → BaseExternalEntity) |
| ☐ | Know how Master-Replica routing works |
| ☐ | Understand caching patterns with jittered TTLs |
| ☐ | Know when to use MySQL vs DynamoDB |
| ☐ | Can identify N+1 query patterns and FETCH JOIN solutions |

**Week 2 Completion Date:** _______________

---

# WEEK 3: PROVIDER INTEGRATION

**Goal:** Understand how payment providers are integrated and routed

## Day 1-2: Adapter Architecture

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Read the complete provider integration document | [03-provider-integration.md](./03-provider-integration.md) |
| ☐ | Study `IPaymentProviderAdapter.java` base class | [03-provider-integration.md#base-adapter-pattern](./03-provider-integration.md), [05-key-files-reference.md#base-classes](./05-key-files-reference.md) |
| ☐ | Understand `PaymentProviderFactory.java` | [03-provider-integration.md#factory-pattern-for-adapter-selection](./03-provider-integration.md) |
| ☐ | Review adapter inheritance diagram | [03-provider-integration.md#adapter-inheritance-diagram](./03-provider-integration.md) |
| ☐ | Understand `ProviderPaymentResponse` structure | [03-provider-integration.md#provider-response-structure](./03-provider-integration.md) |

### Adapter Selection Key
```java
PaymentWorkflowKey {
    OrderType orderType;           // PAY, REFUND
    PaymentProviderKey providerKey; // CASHFREE, CYBERSOURCE
    InstrumentType instrumentType;  // CARD, UPI_APPS
    ThreeDSType threeDSType;        // 3DS1, 3DS2, NONE
}
```

## Day 3: Decision Tree Routing

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Study `ProviderDeciderRouter.java` main router | [03-provider-integration.md#router-strategy-pattern](./03-provider-integration.md), [05-key-files-reference.md#provider-routing](./05-key-files-reference.md) |
| ☐ | Understand LCM vs Decision Tree routing priority | [03-provider-integration.md#routing-flow-diagram](./03-provider-integration.md) |
| ☐ | Review `DecisionTreeObjectCache.java` | [03-provider-integration.md#decision-tree-caching](./03-provider-integration.md) |
| ☐ | Study decision tree factors | [03-provider-integration.md#decision-tree-factors](./03-provider-integration.md) |
| ☐ | Understand `ProviderRoutingDecisionResult` | [03-provider-integration.md#routing-flow-diagram](./03-provider-integration.md) |

### Routing Priority
```
1. LCM (Lending Cloud Manager) - if instrument supported
2. Decision Tree - JSON rules for provider selection
```

## Day 4: Provider Implementations

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Study `CashfreeProviderAdapter.java` (two-phase pattern) | [03-provider-integration.md#cashfree-adapter-example](./03-provider-integration.md), [05-key-files-reference.md#provider-implementations](./05-key-files-reference.md) |
| ☐ | Review `CybersourceProviderAdapter.java` (3DS support) | [03-provider-integration.md#cybersource-adapter-3ds-support](./03-provider-integration.md) |
| ☐ | Understand status code mapping | [03-provider-integration.md#status-code-mapping-cybersource](./03-provider-integration.md) |
| ☐ | Review supported providers table | [03-provider-integration.md#supported-providers](./03-provider-integration.md) |
| ☐ | Understand provider configuration entities | [03-provider-integration.md#provider-configuration](./03-provider-integration.md) |

### 24+ Supported Providers
- Cashfree, Cybersource, PayU, Razorpay, Juspay
- ICICI UPI, Axis UPI, YBL UPI, RBL UPI
- Pine Labs, Digio, Cred Points

## Day 5: Webhooks & Error Handling

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Review webhook architecture | [03-provider-integration.md#webhook-architecture](./03-provider-integration.md) |
| ☐ | Study `CashfreeWebhookController.java` | [03-provider-integration.md#cashfree-webhook-example](./03-provider-integration.md), [05-key-files-reference.md#webhook-controllers](./05-key-files-reference.md) |
| ☐ | Understand idempotency handling | [03-provider-integration.md#idempotency-handling](./03-provider-integration.md) |
| ☐ | Learn error classification (retryable vs non-retryable) | [03-provider-integration.md#error-classification](./03-provider-integration.md) |
| ☐ | Study retry pattern | [03-provider-integration.md#retry-pattern](./03-provider-integration.md) |
| ☐ | Review circuit breaker configuration | [03-provider-integration.md#circuit-breaker-configuration](./03-provider-integration.md) |

### Error Classification
```java
ProviderRequestStatus {
    REQUEST_SUCCESS,          // Processed
    RETRY_ABLE_FAILURE,       // Timeout, rate limit
    NON_RETRY_ABLE_FAILURE    // Invalid request
}
```

---

## ✅ WEEK 3 CHECKPOINT

| Status | Checkpoint Item |
|--------|-----------------|
| ☐ | Can explain adapter pattern and factory selection |
| ☐ | Know how decision tree routing works |
| ☐ | Understand webhook processing flow |
| ☐ | Know error classification and retry patterns |
| ☐ | Can trace a request from routing to provider call |

**Week 3 Completion Date:** _______________

---

# WEEK 4: PAYMENT FLOW

**Goal:** Master the end-to-end payment flow and state machines

## Day 1-2: Workflow Deep-Dive

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Read the complete payment flow document | [04-payment-flow.md](./04-payment-flow.md) |
| ☐ | Study `Workflow.java` base template | [04-payment-flow.md#base-workflow-pattern-template-method](./04-payment-flow.md), [05-key-files-reference.md#base-workflows](./05-key-files-reference.md) |
| ☐ | Master `PaymentAttemptCreateWorkflow.java` | [04-payment-flow.md#paymentattemptcreateworkflow-detailed](./04-payment-flow.md) |
| ☐ | Understand context enrichment pipeline | [04-payment-flow.md#step-1-validate--enrich-context](./04-payment-flow.md) |
| ☐ | Study `PaymentAttemptCreateContext` structure | [04-payment-flow.md#context-object-structure](./04-payment-flow.md) |
| ☐ | Review each step: persist, process, postProcess | [04-payment-flow.md#step-2-persist-intent](./04-payment-flow.md) |

### 7-Step Workflow Pipeline
```
1. validateAndEnrichContext()    // Validate & enrich
2. persistIntent()               // Save to MySQL
3. publishEntityPrePersistEvents() // Pre-persist hooks
4. persistNonRelationalIntent()  // Save to DynamoDB
5. process()                     // Provider API call
6. postProcess()                 // Update with response
7. publishEntityChangeEvents()   // Trigger state machines
```

## Day 3: State Machines

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Study `PaymentStateMachine.java` | [04-payment-flow.md#paymentstatemachine](./04-payment-flow.md), [05-key-files-reference.md#state-machines](./05-key-files-reference.md) |
| ☐ | Study `OrderStateMachine.java` | [04-payment-flow.md#orderstatemachine](./04-payment-flow.md) |
| ☐ | Understand event cascading pattern | [04-payment-flow.md#event-flow-diagram](./04-payment-flow.md) |
| ☐ | Review terminal states | [04-payment-flow.md#state-transition-diagram](./04-payment-flow.md) |
| ☐ | Study `PaymentAttemptEventFactory` | [04-payment-flow.md#event-factory-pattern](./04-payment-flow.md) |

### State Cascade
```
PaymentAttemptEvent → PaymentStateMachine
                           ↓
                    PaymentEvent → OrderStateMachine
                                         ↓
                                  Final Order Status
```

## Day 4: Authentication Flows

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Understand 3DS redirect flow | [04-payment-flow.md#3ds-redirect-flow](./04-payment-flow.md) |
| ☐ | Study Native OTP flow | [04-payment-flow.md#native-otp-flow-card-payments](./04-payment-flow.md) |
| ☐ | Review `PaymentAttemptAuthenticateWorkflow.java` | [04-payment-flow.md#authentication-workflow](./04-payment-flow.md), [05-key-files-reference.md#authentication-workflows](./05-key-files-reference.md) |
| ☐ | Study DynamoDB OTP storage | [04-payment-flow.md#dynamodb-entity-for-otp](./04-payment-flow.md) |
| ☐ | Understand instrument processing | [04-payment-flow.md#instrument-processing](./04-payment-flow.md) |
| ☐ | Study `CardInstrumentTypeProcessor.java` | [04-payment-flow.md#card-instrument-processing](./04-payment-flow.md) |

### Auth Flow Types
- **3DS Redirect:** User redirects to issuer page
- **Native OTP:** OTP captured in app, sent to provider

## Day 5: Advanced Patterns

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Study `SequentialWorkflow.java` (distributed locks) | [04-payment-flow.md#sequentialworkflow-pattern](./04-payment-flow.md), [05-key-files-reference.md#locking--sequencing](./05-key-files-reference.md) |
| ☐ | Review Guava EventBus setup | [04-payment-flow.md#guava-eventbus-setup](./04-payment-flow.md) |
| ☐ | Study end-to-end flow diagram | [04-payment-flow.md#complete-flow-diagram](./04-payment-flow.md) |
| ☐ | Review async processing (Kafka, SQS) | [05-key-files-reference.md#kafka--sqs](./05-key-files-reference.md) |
| ☐ | Study processor implementations | [04-payment-flow.md#processor-implementations](./04-payment-flow.md) |

---

## ✅ WEEK 4 CHECKPOINT

| Status | Checkpoint Item |
|--------|-----------------|
| ☐ | Can trace payment creation flow step by step |
| ☐ | Understand state machine event cascading |
| ☐ | Know 3DS and Native OTP authentication flows |
| ☐ | Understand distributed locking pattern |
| ☐ | Can explain Guava EventBus usage |

**Week 4 Completion Date:** _______________

---

# EXPERT CHALLENGES

**Goal:** Apply your knowledge to real-world scenarios

## Challenge 1: Trace a Card Payment End-to-End

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Start from `PaymentAttemptV2Controller` | [05-key-files-reference.md#primary-v2-controllers](./05-key-files-reference.md) |
| ☐ | Follow through `PaymentAttemptCreateWorkflow` | [04-payment-flow.md#paymentattemptcreateworkflow-detailed](./04-payment-flow.md) |
| ☐ | Trace provider adapter selection | [03-provider-integration.md#factory-pattern-for-adapter-selection](./03-provider-integration.md) |
| ☐ | Follow 3DS flow if triggered | [04-payment-flow.md#3ds-redirect-flow](./04-payment-flow.md) |
| ☐ | Track state machine events | [04-payment-flow.md#state-machine-implementation](./04-payment-flow.md) |
| ☐ | End at final order status | [04-payment-flow.md#orderstatemachine](./04-payment-flow.md) |

## Challenge 2: Add a New Provider (Conceptual)

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Identify extension points in adapter pattern | [03-provider-integration.md#provider-adapter-architecture](./03-provider-integration.md) |
| ☐ | Design adapter extending `IPaymentProviderAdapter` | [03-provider-integration.md#base-adapter-pattern](./03-provider-integration.md) |
| ☐ | Plan registration in `PaymentProviderFactory` | [03-provider-integration.md#paymentproviderfactory](./03-provider-integration.md) |
| ☐ | Design webhook controller | [03-provider-integration.md#webhook-handling](./03-provider-integration.md) |
| ☐ | Plan status code mapping | [03-provider-integration.md#status-code-mapping-cybersource](./03-provider-integration.md) |

## Challenge 3: Debug a Failed Payment

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Find payment attempt by external_id | [02-data-layer.md#key-repository-methods](./02-data-layer.md) |
| ☐ | Check `provider_status` and `error_code` fields | [02-data-layer.md#paymentattemptv2entity](./02-data-layer.md) |
| ☐ | Review DynamoDB workflow context | [02-data-layer.md#dynamodb-tables](./02-data-layer.md) |
| ☐ | Check state machine event logs | [04-payment-flow.md#state-machine-implementation](./04-payment-flow.md) |
| ☐ | Identify root cause category | [03-provider-integration.md#error-classification](./03-provider-integration.md) |

## Challenge 4: Optimize a Query

| Status | Task | Reference |
|--------|------|-----------|
| ☐ | Identify potential N+1 query pattern | [02-data-layer.md#jpa-repository-pattern](./02-data-layer.md) |
| ☐ | Add FETCH JOIN to optimize | [02-data-layer.md#jpa-repository-pattern](./02-data-layer.md) |
| ☐ | Consider caching opportunity | [02-data-layer.md#caching-architecture](./02-data-layer.md) |
| ☐ | Evaluate replica usage for reads | [02-data-layer.md#usage-pattern](./02-data-layer.md) |

---

## ✅ EXPERT CHECKPOINT

| Status | Checkpoint Item |
|--------|-----------------|
| ☐ | Can trace any payment flow end-to-end |
| ☐ | Can debug production payment issues |
| ☐ | Can design new provider integrations |
| ☐ | Can optimize database queries |
| ☐ | Can explain any component to team members |

**Expert Level Completion Date:** _______________

---

# SUMMARY

## Completion Status

| Phase | Status | Date Completed |
|-------|--------|----------------|
| Week 1: Foundation | ☐ Not Complete | |
| Week 2: Data Layer | ☐ Not Complete | |
| Week 3: Provider Integration | ☐ Not Complete | |
| Week 4: Payment Flow | ☐ Not Complete | |
| Expert Challenges | ☐ Not Complete | |

## Key Documents by Topic

| When Debugging... | Reference |
|-------------------|-----------|
| Payment creation issues | [04-payment-flow.md](./04-payment-flow.md) |
| Provider failures | [03-provider-integration.md](./03-provider-integration.md) |
| Database/cache issues | [02-data-layer.md](./02-data-layer.md) |
| State transition bugs | [04-payment-flow.md#state-machine-implementation](./04-payment-flow.md) |
| Finding files | [05-key-files-reference.md](./05-key-files-reference.md) |

## Critical Files Quick Reference

| Category | File |
|----------|------|
| Entry Point | `DarwinApplication.java` |
| Main Workflow | `PaymentAttemptCreateWorkflow.java` |
| Payment States | `PaymentStateMachine.java` |
| Provider Routing | `ProviderDeciderRouter.java` |
| Base Adapter | `IPaymentProviderAdapter.java` |
| Config | `application.properties` |

---

## Notes

### Session Notes
```
[Add your notes from each study session here]
```

### Questions to Research
```
[Add questions that come up during study]
```

### Key Insights
```
[Add important discoveries and "aha" moments]
```

---

*Last Updated: _______________*

*Good luck on your journey to becoming a Darwin expert!*
