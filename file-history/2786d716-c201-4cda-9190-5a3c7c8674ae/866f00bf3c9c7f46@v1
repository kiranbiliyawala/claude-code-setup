# Development Commands Reference

Complete reference for all development commands in finhq-verse.

---

## Nx Commands

### Build

```bash
# Build single project
npx nx build finhq-foundation

# Build all projects
npx nx run-many --target=build --all

# Build only affected projects (since base branch)
npx nx affected --target=build

# Build with verbose output
npx nx build finhq-foundation --verbose

# Build with specific configuration
npx nx build finhq-foundation --configuration=production
```

### Test

```bash
# Test single project
npx nx test finhq-foundation

# Test all projects
npx nx run-many --target=test --all

# Test affected projects
npx nx affected --target=test

# Test with coverage
npx nx test finhq-foundation --coverage

# Run specific test file
npx nx test finhq-foundation --testFile=OrganizationServiceTest
```

### Lint

```bash
# Lint single project
npx nx lint finhq-foundation

# Lint all projects
npx nx run-many --target=lint --all

# Lint affected
npx nx affected --target=lint

# Fix lint issues
npx nx lint finhq-foundation --fix
```

### Serve (Run)

```bash
# Run a service
npx nx serve finhq-foundation

# Run with specific port
npx nx serve finhq-foundation --port=8080
```

### Graph

```bash
# Open dependency graph in browser
npx nx graph

# Output graph to file
npx nx graph --file=output/graph.html

# Show affected graph
npx nx affected:graph
```

### Utility

```bash
# List all projects
npx nx show projects

# Show project details
npx nx show project finhq-foundation

# Clear cache
npx nx reset

# Check workspace
npx nx workspace-lint
```

---

## Make Commands

```bash
# Install dependencies (Mac)
make install

# Start Docker stack
make up

# Stop Docker stack
make down

# Build affected projects
make refresh

# Full rebuild and restart
make restart

# View logs
make logs

# Clean build artifacts
make clean
```

---

## Gradle Commands

```bash
# Build
./gradlew build

# Build without tests
./gradlew build -x test

# Clean build
./gradlew clean build

# Test
./gradlew test

# Run specific test class
./gradlew test --tests "OrganizationServiceTest"

# Format code (Spotless)
./gradlew spotlessApply

# Check formatting
./gradlew spotlessCheck

# Generate OpenAPI code
./gradlew openApiGenerate

# Run PMD analysis
./gradlew pmdMain
```

---

## Docker Commands

### Docker Compose

```bash
# Start all services
docker-compose up -d

# Start specific services
docker-compose up -d mysql redis

# Stop all services
docker-compose down

# Stop and remove volumes
docker-compose down -v

# View logs
docker-compose logs -f

# View logs for specific service
docker-compose logs -f finhq-foundation

# Restart a service
docker-compose restart finhq-foundation

# Rebuild and restart
docker-compose up -d --build finhq-foundation
```

### Docker

```bash
# List running containers
docker ps

# List all containers
docker ps -a

# View container logs
docker logs <container_id>

# Execute command in container
docker exec -it <container_id> bash

# Connect to MySQL
docker exec -it finhq-mysql mysql -u root -p
```

---

## MySQL Commands

```bash
# Connect to MySQL (via Docker)
docker exec -it finhq-mysql mysql -u root -p

# Connect with specific database
docker exec -it finhq-mysql mysql -u root -p finhq_foundation
```

### Common SQL

```sql
-- Show databases
SHOW DATABASES;

-- Use database
USE finhq_foundation;

-- Show tables
SHOW TABLES;

-- Describe table
DESCRIBE organizations;

-- Show audit history
SELECT * FROM organizations_aud ORDER BY rev DESC;

-- Show revisions
SELECT * FROM revinfo ORDER BY id DESC LIMIT 10;
```

---

## Git Commands

```bash
# Status
git status

# Create feature branch
git checkout -b feature/my-feature

# Add changes
git add .

# Commit
git commit -m "feat: add new feature"

# Push
git push origin feature/my-feature

# Pull latest
git pull origin master

# Rebase on master
git rebase master
```

---

## cURL Commands

### Organizations

```bash
# Create
curl -X POST http://localhost:7080/v1/organizations \
  -H "Content-Type: application/json" \
  -H "X-Finhq-Mode: LIVE" \
  -d '{
    "name": "Test Org",
    "country": "IN",
    "timezone": "Asia/Kolkata"
  }'

# List
curl "http://localhost:7080/v1/organizations?pageSize=10" \
  -H "X-Finhq-Mode: LIVE"

# Get by ID
curl http://localhost:7080/v1/organizations/01H123... \
  -H "X-Finhq-Mode: LIVE"

# Update
curl -X PATCH http://localhost:7080/v1/organizations/01H123... \
  -H "Content-Type: application/json" \
  -H "X-Finhq-Mode: LIVE" \
  -d '{"name": "Updated Name"}'
```

### With Full Headers

```bash
curl -X POST http://localhost:7080/v1/namespaces \
  -H "Content-Type: application/json" \
  -H "X-Finhq-Mode: LIVE" \
  -H "X-Finhq-Org-Id: 01H123..." \
  -H "X-Finhq-Request-Id: req-001" \
  -d '{
    "name": "Default Namespace"
  }'
```

### Pretty Print JSON

```bash
curl http://localhost:7080/v1/organizations \
  -H "X-Finhq-Mode: LIVE" | jq .
```

---

## Service URLs

| Service | URL |
|---------|-----|
| Foundation | http://localhost:7080 |
| Bookkeeping | http://localhost:7081 |
| Consumer | http://localhost:7082 |
| Configuration | http://localhost:7084 |
| Calendar | http://localhost:7085 |
| Settlement | http://localhost:7086 |
| OpenAPI Docs | http://localhost:7090 |
| Jaeger UI | http://localhost:16686 |
| Temporal UI | http://localhost:8080 |

---

## Health Checks

```bash
# Foundation health
curl http://localhost:7080/actuator/health

# All actuator endpoints
curl http://localhost:7080/actuator

# Prometheus metrics
curl http://localhost:7080/actuator/prometheus
```

---

## Debugging

### Enable Debug Logging

```bash
# Via environment variable
export LOGGING_LEVEL_IO_FINHQ=DEBUG
npx nx serve finhq-foundation

# Via application.yml
logging:
  level:
    io.finhq: DEBUG
```

### JVM Debug

```bash
# Run with debug port
./gradlew bootRun --debug-jvm

# Or set JAVA_OPTS
export JAVA_OPTS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005"
```

---

## Common Workflows

### Start Development

```bash
# 1. Start infrastructure
make up

# 2. Build all projects
npx nx run-many --target=build --all

# 3. Start the service you're working on
npx nx serve finhq-foundation
```

### Before Committing

```bash
# 1. Format code
./gradlew spotlessApply

# 2. Run tests
npx nx affected --target=test

# 3. Check lint
npx nx affected --target=lint
```

### After Pulling Changes

```bash
# 1. Rebuild affected
npx nx affected --target=build

# 2. Run affected tests
npx nx affected --target=test
```

### Adding a New API

```bash
# 1. Edit OpenAPI spec
# finhq-openapi/specs/<service>.yaml

# 2. Regenerate code
npx nx build finhq-openapi-java

# 3. Implement the delegate in your service

# 4. Run tests
npx nx test <service>
```
